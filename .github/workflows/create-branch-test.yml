name: Create branch from ref

on:
  workflow_dispatch:
    inputs:
      source_ref:
        description: "Source ref: branch/tag name (main, v1.0.0) or full ref (refs/heads/main, refs/tags/v1.0.0)"
        required: true
        type: string
      branch_name:
        description: "Optional explicit branch name. If empty -> auto generated."
        required: false
        type: string
        default: ""
      auto_name_strategy:
        description: "Auto-name strategy: auto | release | timestamp | short-sha | source-only"
        required: false
        type: choice
        default: auto
        options:
          - auto
          - release
          - timestamp
          - short-sha
          - source-only
      branch_prefix:
        description: "Optional custom prefix (e.g. hotfix, feature, release). Leave empty to use defaults."
        required: false
        type: string
        default: ""
      branch_separator:
        description: "Separator between prefix and name: / or -"
        required: false
        type: choice
        default: /
        options:
          - /
          - "-"
      check_branch:
        description: "Fail if branch exists on remote"
        required: false
        type: boolean
        default: true
      force_create:
        description: "Delete and recreate branch if exists"
        required: false
        type: boolean
        default: false
      push_branch:
        description: "Push the branch to origin"
        required: false
        type: boolean
        default: true
      dry_run:
        description: "Do not create/push anything, just print what would happen"
        required: false
        type: boolean
        default: false

permissions:
  contents: write

jobs:
  create-branch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6.0.1
        with:
          fetch-depth: 0

      - name: Create branch
        id: cb
        uses: ./.github/actions/create-branch
        with:
          source-ref: ${{ inputs.source_ref }}
          branch-name: ${{ inputs.branch_name }}
          auto-name-strategy: ${{ inputs.auto_name_strategy }}
          branch-prefix: ${{ inputs.branch_prefix }}
          branch-separator: ${{ inputs.branch_separator }}
          check-branch: ${{ inputs.check_branch }}
          force-create: ${{ inputs.force_create }}
          push-branch: ${{ inputs.push_branch }}
          dry-run: ${{ inputs.dry_run }}

      - name: Summary
        run: |
          echo "Created branch: ${{ steps.cb.outputs.created-branch }}"
          echo "Source ref: ${{ inputs.source_ref }}"
